'use strict';

var react = require('react');
var jsxRuntime = require('react/jsx-runtime');

var q=(r,o)=>{if(!r)return;let t=r.getContext("2d");if(!t)return;let e=r.width,n=r.height,i=t.createLinearGradient(1,1,1,n-1);i.addColorStop(0,"white"),i.addColorStop(1,"black");let s=t.createLinearGradient(1,0,e-1,0);s.addColorStop(0,`hsla(${o},100%,50%,0)`),s.addColorStop(1,`hsla(${o},100%,50%,1)`),t.fillStyle=i,t.fillRect(0,0,e,n),t.fillStyle=s,t.globalCompositeOperation="multiply",t.fillRect(0,0,e,n),t.globalCompositeOperation="source-over";},J=r=>{if(!r)return;let o=r.getContext("2d");if(!o)return;let t=r.width,e=r.height,n=o.createLinearGradient(0,0,t,0);for(let i=0;i<=36;i++)n.addColorStop(i/36,`hsla(${i*10}, 100%, 50%, 1)`);o.fillStyle=n,o.fillRect(0,0,t,e);};var K=(r,o)=>{if(!r)return null;let t=o/r.width*360;return Math.max(0,Math.min(360,t))},Q=(r,o)=>!r||o===null||o===void 0?null:r.width*o/360,Z=(r,o,t)=>{if(!r)return null;let e=r.getContext("2d");if(!e)return null;try{let n=e.getImageData(o,t,1,1).data;return `rgb(${n[0]}, ${n[1]}, ${n[2]})`}catch(n){return console.error("Error getting color at position:",n),null}},rr=(r,o)=>{if(!r||!o)return null;let t=r?.getContext("2d");if(!t)return null;let e=r.width,n=r.height;try{let i=t.getImageData(0,0,e,n).data,s={x:0,y:0,difference:Number.MAX_VALUE},c=o.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(!c)return null;let u=parseInt(c[1],10),a=parseInt(c[2],10),f=parseInt(c[3],10);for(let p=0;p<n;p++)for(let h=0;h<e;h++){let d=(p*e+h)*4,m=i[d],b=i[d+1],k=i[d+2],x=Math.sqrt(Math.pow((m-u)*.299,2)+Math.pow((b-a)*.587,2)+Math.pow((k-f)*.114,2));x<s.difference&&(s={x:h,y:p,difference:x});}return {x:s.x,y:s.y}}catch(i){return console.error("Error finding color position:",i),null}};var P=class{constructor(o,t,e){this.h=o;this.s=t;this.l=e;this.h=o,this.s=t,this.l=e;}toString(){return `hsl(${this.h}, ${this.s}%, ${this.l}%)`}};var C=class{constructor(o,t,e){this.r=o;this.g=t;this.b=e;this.r=o,this.g=t,this.b=e;}toString(){return `rgb(${this.r}, ${this.g}, ${this.b})`}toRgba(o=1){return `rgba(${this.r}, ${this.g}, ${this.b}, ${o})`}};var S=class{constructor(o,t,e){this.h=o;this.s=t;this.v=e;this.h=o,this.s=t,this.v=e;}toString(){return `hsv(${this.h}, ${this.s}%, ${this.v}%)`}};var $=class{constructor(o,t,e,n){this.c=o;this.m=t;this.y=e;this.k=n;this.c=o,this.m=t,this.y=e,this.k=n;}toString(){return `cmyk(${this.c*100}%, ${this.m*100}%, ${this.y*100}%, ${this.k*100}%)`}};var H=class{constructor(o){this.value=o;if(this.value=o.replace("#",""),!/^[0-9A-Fa-f]{6}$/.test(this.value))throw new Error("Invalid hex color value")}toString(){return `#${this.value}`}};function D(r,o,t){r/=255,o/=255,t/=255;let e=1-Math.max(r,o,t);return e===1?{c:0,m:0,y:0,k:1}:{c:(1-r-e)/(1-e),m:(1-o-e)/(1-e),y:(1-t-e)/(1-e),k:e}}function L(r,o,t){return `#${((1<<24)+(r<<16)+(o<<8)+t).toString(16).slice(1).toUpperCase()}`}function O(r,o,t){r/=255,o/=255,t/=255;let e=Math.max(r,o,t),n=Math.min(r,o,t),i,s,c=(e+n)/2;if(e===n)i=s=0;else {let u=e-n;switch(s=c>.5?u/(2-e-n):u/(e+n),e){case r:i=(o-t)/u+(o<t?6:0);break;case o:i=(t-r)/u+2;break;case t:i=(r-o)/u+4;break}i/=6;}return {h:Math.round(i*360),s:Math.round(s*100),l:Math.round(c*100)}}function _(r,o,t){r/=255,o/=255,t/=255;let e=Math.max(r,o,t),n=Math.min(r,o,t),i,s=e,c=e-n,u=e===0?0:c/e;if(e===n)i=0;else {switch(e){case r:i=(o-t)/c+(o<t?6:0);break;case o:i=(t-r)/c+2;break;case t:i=(r-o)/c+4;break}i/=6;}return {h:Math.round(i*360),s:Math.round(u*100),v:Math.round(s*100)}}function X(r,o,t){r/=360,o/=100,t/=100;let e,n,i;if(o===0)e=n=i=t;else {let s=(a,f,p)=>(p<0&&(p+=1),p>1&&(p-=1),p<.16666666666666666?a+(f-a)*6*p:p<.5?f:p<.6666666666666666?a+(f-a)*(.6666666666666666-p)*6:a),c=t<.5?t*(1+o):t+o-t*o,u=2*t-c;e=s(u,c,r+1/3),n=s(u,c,r),i=s(u,c,r-1/3);}return {r:Math.round(e*255),g:Math.round(n*255),b:Math.round(i*255)}}function v(r){let o=document.createElement("div");o.style.color=r,document.body.appendChild(o);let t=window.getComputedStyle(o).color;document.body.removeChild(o);let e=t.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(!e)throw new Error(`Could not parse color: ${r}`);let n=parseInt(e[1],10),i=parseInt(e[2],10),s=parseInt(e[3],10),c=parseFloat(e[4]||"1"),u=O(n,i,s),a=_(n,i,s);return {hex:L(n,i,s),rgb:{r:n,g:i,b:s,a:c},hsl:{h:Math.round(u.h),s:Math.round(u.s),l:Math.round(u.l)},hsv:{h:Math.round(a.h),s:Math.round(a.s),v:Math.round(a.v)}}}function A(r,o){let{rgb:t}=v(r);return `rgba(${t.r}, ${t.g}, ${t.b}, ${o})`}function tr(r,o){let{hsl:t}=v(r),e={h:o,s:t.s,l:t.l},n=X(e.h,e.s,e.l);return ar({r:n.r,g:n.g,b:n.b})}function Qr(r,o,t=1){let e=v(r);if(o==="rgb")return t!==1?`rgba(${e.rgb.r}, ${e.rgb.g}, ${e.rgb.b}, ${t})`:`rgb(${e.rgb.r}, ${e.rgb.g}, ${e.rgb.b})`;if(o==="hsl")return t!==1?`hsla(${e.hsl.h}, ${e.hsl.s}%, ${e.hsl.l}%, ${t})`:`hsl(${e.hsl.h}, ${e.hsl.s}%, ${e.hsl.l}%)`;if(o==="hex")return e.hex;if(o==="hsv")return `hsv(${e.hsv.h}, ${e.hsv.s}%, ${e.hsv.v}%)`;if(o==="cmyk"){let n=D(e.rgb.r,e.rgb.g,e.rgb.b);return `cmyk(${Math.round(n.c*100)}%, ${Math.round(n.m*100)}%, ${Math.round(n.y*100)}%, ${Math.round(n.k*100)}%)`}return r}function Zr(r){return new P(r.h,r.s,r.l).toString()}function ar(r){return new C(r.r,r.g,r.b).toString()}function rt(r){return new S(r.h,r.s,r.v).toString()}function tt(r){return new $(r.c,r.m,r.y,r.k).toString()}function et(r){return new H(r).toString()}var er=(r,o)=>{let t=o.getBoundingClientRect(),e=0,n=0;"touches"in r?r.touches.length>0?(e=r.touches[0].clientX,n=r.touches[0].clientY):r.changedTouches&&r.changedTouches.length>0&&(e=r.changedTouches[0].clientX,n=r.changedTouches[0].clientY):(e=r.clientX,n=r.clientY);let i=Math.min(Math.max(0,Math.round(e-t.left)),o.clientWidth),s=Math.min(Math.max(0,Math.round(n-t.top)),o.clientHeight);return {x:i,y:s}},y=(r,o,t,e)=>{if(!r)return ()=>{};let n=false,i=null,s=a=>{if(!n||a.pointerId!==i)return;a.preventDefault();let f=er(a,r);requestAnimationFrame(()=>{o(f);});},c=a=>{!n||a.pointerId!==i||(n=false,r.releasePointerCapture(a.pointerId),i=null,r.removeEventListener("pointermove",s),r.removeEventListener("pointerup",c),t&&t());},u=a=>{if(n)return;n=true,i=a.pointerId,r.setPointerCapture(a.pointerId),a.preventDefault(),a.stopPropagation(),r.addEventListener("pointermove",s),r.addEventListener("pointerup",c);let f=er(a,r);o(f);};return r.addEventListener("pointerdown",u),e?.current&&e.current.addEventListener("pointerdown",u),()=>{r.removeEventListener("pointerdown",u),e?.current&&e.current.removeEventListener("pointerdown",u),n&&i!==null&&(r.removeEventListener("pointermove",s),r.removeEventListener("pointerup",c),r.releasePointerCapture(i));}};function g(...r){let o=[];return r.forEach(t=>{if(!t)return;let e=typeof t;if(e==="string"||e==="number")o.push(t);else if(Array.isArray(t)){if(t.length){let n=g(...t);n&&o.push(n);}}else if(e==="object")if(t.toString===Object.prototype.toString)for(let n in t)Object.hasOwnProperty.call(t,n)&&t[n]&&o.push(n);else o.push(t.toString());}),o.join(" ")}var F=react.createContext(void 0),M=()=>{let r=react.useContext(F);if(r===void 0)throw new Error("usePageBuilder must be used within a PageBuilderProvider");return r};var W=({classNames:r={}})=>{let{hue:o,color:t,setColor:e}=M(),n=react.useRef(null),i=react.useRef(null),s=react.useRef(null),c=react.useRef(false),u=react.useRef(false);react.useEffect(()=>{n.current&&s.current&&(n.current.width=s.current.clientWidth??0,n.current.height=s.current.clientHeight??0,q(n.current,o),p(o));},[o]),react.useEffect(()=>s.current?y(s.current,f,h,i):void 0,[]),react.useEffect(()=>{a(t);},[]);let a=react.useCallback(m=>{if(!n.current||!i.current||u.current)return;u.current=true;let{rgb:b}=v(m),k=new C(b.r,b.g,b.b),x=rr(n.current,k.toString());x&&(i.current.style.transform=`translate(${x.x}px, ${x.y}px) translate(-50%, -50%)`),e(m);},[]),f=react.useCallback(({x:m,y:b})=>{if(!s.current||!i.current)return;let k=Math.max(0,Math.min(m,s.current.clientWidth-1)),x=Math.max(0,Math.min(b,s.current.clientHeight-1));if(i.current.style.transform=`translate(${k}px, ${x}px) translate(-50%, -50%)`,c.current=true,!n.current)return;let j=Z(n.current,k,x);j&&e(j);},[]),p=react.useCallback(m=>{let b=tr(t,m);e(b);},[t]),h=react.useCallback(()=>{c.current=false;},[]),d=react.useCallback(m=>{m.stopPropagation();},[]);return jsxRuntime.jsxs("div",{className:g("cp-color-block",r.container),ref:s,children:[jsxRuntime.jsx("canvas",{ref:n,className:g("cp-color-block__canvas",r.gradient)}),jsxRuntime.jsx("div",{ref:i,className:g(r.marker,"cp-color-block__marker"),style:{backgroundColor:t},onMouseDown:d,onTouchStart:m=>m.stopPropagation()})]})};var Y=({classNames:r})=>{let{hue:o,setHue:t,setColor:e,color:n}=M(),i=react.useRef(null),s=react.useRef(null),c=react.useRef(null),u=react.useRef(false),a=react.useRef(false);react.useEffect(()=>{i.current&&c.current&&(i.current.width=c.current.clientWidth??0,i.current.height=c.current.clientHeight??0,J(i.current));},[]),react.useEffect(()=>{if(!i.current||!s.current||a.current)return;a.current=true;let d=Q(i.current,o);typeof d=="number"&&(s.current.style.transform=`translateX(${d}px) translate(-50%, -50%)`);},[]);let f=react.useCallback(({x:d})=>{if(!c.current||!s.current)return;let m=d;if(s.current.style.transform=`translateX(${m}px) translate(-50%, -50%)`,u.current=true,!i.current)return;let b=K(i.current,m);typeof b=="number"&&t(b);},[]),p=react.useCallback(()=>{u.current=false;},[]);react.useEffect(()=>!c.current||!s.current?void 0:y(c.current,f,p,s),[f,p]);let h=d=>{d.stopPropagation();};return jsxRuntime.jsxs("div",{className:g("cp-color-strip",r?.container),ref:c,children:[jsxRuntime.jsx("canvas",{ref:i,className:g("cp-color-strip__canvas",r?.canvas)}),jsxRuntime.jsx("div",{ref:s,className:g("cp-color-strip__marker",r?.marker),style:{backgroundColor:`hsla(${o}, 100%, 50%, 1)`},onMouseDown:h})]})};var U=({classNames:r})=>{let{color:o,opacity:t,setOpacity:e,setColor:n}=M(),i=react.useRef(null),s=react.useRef(null),c=react.useRef(false),u=react.useRef(false);react.useEffect(()=>{let h=A(o,t);n(h);},[t]),react.useEffect(()=>i.current?y(i.current,a,f,s):void 0,[]),react.useEffect(()=>{if(!i.current||!s.current||u.current)return;u.current=true;let d=i.current.offsetWidth*t;s.current.style.transform=`translateX(${d}px) translate(-50%, -50%)`;},[]);let a=react.useCallback(({x:h})=>{if(!i.current||!s.current)return;let d=i.current.offsetWidth,m=Math.max(0,Math.min(d,h));s.current.style.transform=`translateX(${m}px) translate(-50%, -50%)`,c.current=true;let b=m/d;e(b);},[]),f=react.useCallback(()=>{c.current=false;},[]),p=h=>{h.stopPropagation();};return jsxRuntime.jsx("div",{className:g("cp-opacity-slider",r?.container),style:{background:`linear-gradient(to right, rgba(0,0,0,0), ${A(o,1)})`},ref:i,children:jsxRuntime.jsx("div",{ref:s,className:g("cp-opacity-slider__marker",r?.marker),onMouseDown:p,onTouchStart:h=>h.stopPropagation(),style:{backgroundColor:o}})})};var w=({children:r,onChange:o,defaultColor:t="rgb(255,255,255)"})=>{let[e,n]=react.useState(255),[i,s]=react.useState(t),[c,u]=react.useState(1),[a,f]=react.useState(true);return react.useEffect(()=>{o(i,c,e);},[i,c,e]),react.useEffect(()=>{let{rgb:{r:p,g:h,b:d,a:m},hsl:{h:b}}=v(t);n(b),s(`rgb(${p}, ${h}, ${d})`),u(m??1),f(false);},[]),jsxRuntime.jsx(F.Provider,{value:{hue:e,opacity:c,color:i,setColor:s,setHue:n,setOpacity:u},children:!a&&r})};w.displayName="ColorPicker";w.Block=()=>jsxRuntime.jsx(W,{});w.Block.displayName="ColorPicker.Block";w.Strip=()=>jsxRuntime.jsx(Y,{});w.Strip.displayName="ColorPicker.Strip";w.Opacity=()=>jsxRuntime.jsx(U,{});

exports.ColorBlock = W;
exports.ColorPicker = w;
exports.ColorPickerContext = F;
exports.ColorStrip = Y;
exports.OpacitySlider = U;
exports.changeHue = tr;
exports.changeOpacity = A;
exports.cmykToString = tt;
exports.convert = Qr;
exports.hexToString = et;
exports.hslToString = Zr;
exports.hsvToString = rt;
exports.parseColor = v;
exports.rgbToString = ar;
exports.useColorPicker = M;
