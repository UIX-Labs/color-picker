import { createContext, useState, useEffect, useRef, useCallback, useContext } from 'react';
import { jsx, jsxs } from 'react/jsx-runtime';

var J=(r,o)=>{if(!r)return;let t=r.getContext("2d");if(!t)return;let e=r.width,n=r.height,i=t.createLinearGradient(1,1,1,n-1);i.addColorStop(0,"white"),i.addColorStop(1,"black");let s=t.createLinearGradient(1,0,e-1,0);s.addColorStop(0,`hsla(${o},100%,50%,0)`),s.addColorStop(1,`hsla(${o},100%,50%,1)`),t.fillStyle=i,t.fillRect(0,0,e,n),t.fillStyle=s,t.globalCompositeOperation="multiply",t.fillRect(0,0,e,n),t.globalCompositeOperation="source-over";},K=r=>{if(!r)return;let o=r.getContext("2d");if(!o)return;let t=r.width,e=r.height,n=o.createLinearGradient(0,0,t,0);for(let i=0;i<=36;i++)n.addColorStop(i/36,`hsla(${i*10}, 100%, 50%, 1)`);o.fillStyle=n,o.fillRect(0,0,t,e);};var Q=(r,o)=>{if(!r)return null;let t=o/r.width*360;return Math.max(0,Math.min(360,t))},Z=(r,o)=>!r||o===null||o===void 0?null:r.width*o/360,rr=(r,o,t)=>{if(!r)return null;let e=r.getContext("2d");if(!e)return null;try{let n=e.getImageData(o,t,1,1).data;return `rgb(${n[0]}, ${n[1]}, ${n[2]})`}catch(n){return console.error("Error getting color at position:",n),null}},tr=(r,o)=>{if(!r||!o)return null;let t=r?.getContext("2d");if(!t)return null;let e=r.width,n=r.height;try{let i=t.getImageData(0,0,e,n).data,s={x:0,y:0,difference:Number.MAX_VALUE},c=o.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(!c)return null;let u=parseInt(c[1],10),a=parseInt(c[2],10),b=parseInt(c[3],10);for(let m=0;m<n;m++)for(let d=0;d<e;d++){let f=(m*e+d)*4,h=i[f],g=i[f+1],y=i[f+2],C=Math.sqrt(Math.pow((h-u)*.299,2)+Math.pow((g-a)*.587,2)+Math.pow((y-b)*.114,2));C<s.difference&&(s={x:d,y:m,difference:C});}return {x:s.x,y:s.y}}catch(i){return console.error("Error finding color position:",i),null}};var S=class{constructor(o,t,e){this.h=o;this.s=t;this.l=e;this.h=o,this.s=t,this.l=e;}toString(){return `hsl(${this.h}, ${this.s}%, ${this.l}%)`}};var v=class{constructor(o,t,e){this.r=o;this.g=t;this.b=e;this.r=o,this.g=t,this.b=e;}toString(){return `rgb(${this.r}, ${this.g}, ${this.b})`}toRgba(o=1){return `rgba(${this.r}, ${this.g}, ${this.b}, ${o})`}};var $=class{constructor(o,t,e){this.h=o;this.s=t;this.v=e;this.h=o,this.s=t,this.v=e;}toString(){return `hsv(${this.h}, ${this.s}%, ${this.v}%)`}};var H=class{constructor(o,t,e,n){this.c=o;this.m=t;this.y=e;this.k=n;this.c=o,this.m=t,this.y=e,this.k=n;}toString(){return `cmyk(${this.c*100}%, ${this.m*100}%, ${this.y*100}%, ${this.k*100}%)`}};var E=class{constructor(o){this.value=o;if(this.value=o.replace("#",""),!/^[0-9A-Fa-f]{6}$/.test(this.value))throw new Error("Invalid hex color value")}toString(){return `#${this.value}`}};function L(r,o,t){r/=255,o/=255,t/=255;let e=1-Math.max(r,o,t);return e===1?{c:0,m:0,y:0,k:1}:{c:(1-r-e)/(1-e),m:(1-o-e)/(1-e),y:(1-t-e)/(1-e),k:e}}function O(r,o,t){return `#${((1<<24)+(r<<16)+(o<<8)+t).toString(16).slice(1).toUpperCase()}`}function _(r,o,t){r/=255,o/=255,t/=255;let e=Math.max(r,o,t),n=Math.min(r,o,t),i,s,c=(e+n)/2;if(e===n)i=s=0;else {let u=e-n;switch(s=c>.5?u/(2-e-n):u/(e+n),e){case r:i=(o-t)/u+(o<t?6:0);break;case o:i=(t-r)/u+2;break;case t:i=(r-o)/u+4;break}i/=6;}return {h:Math.round(i*360),s:Math.round(s*100),l:Math.round(c*100)}}function B(r,o,t){r/=255,o/=255,t/=255;let e=Math.max(r,o,t),n=Math.min(r,o,t),i,s=e,c=e-n,u=e===0?0:c/e;if(e===n)i=0;else {switch(e){case r:i=(o-t)/c+(o<t?6:0);break;case o:i=(t-r)/c+2;break;case t:i=(r-o)/c+4;break}i/=6;}return {h:Math.round(i*360),s:Math.round(u*100),v:Math.round(s*100)}}function A(r,o,t){r/=360,o/=100,t/=100;let e,n,i;if(o===0)e=n=i=t;else {let s=(a,b,m)=>(m<0&&(m+=1),m>1&&(m-=1),m<.16666666666666666?a+(b-a)*6*m:m<.5?b:m<.6666666666666666?a+(b-a)*(.6666666666666666-m)*6:a),c=t<.5?t*(1+o):t+o-t*o,u=2*t-c;e=s(u,c,r+1/3),n=s(u,c,r),i=s(u,c,r-1/3);}return {r:Math.round(e*255),g:Math.round(n*255),b:Math.round(i*255)}}function k(r){let o=document.createElement("div");o.style.color=r,document.body.appendChild(o);let t=window.getComputedStyle(o).color;document.body.removeChild(o);let e=t.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(!e)throw new Error(`Could not parse color: ${r}`);let n=parseInt(e[1],10),i=parseInt(e[2],10),s=parseInt(e[3],10),c=parseFloat(e[4]||"1"),u=_(n,i,s),a=B(n,i,s);return {hex:O(n,i,s),rgb:{r:n,g:i,b:s,a:c},hsl:{h:Math.round(u.h),s:Math.round(u.s),l:Math.round(u.l)},hsv:{h:Math.round(a.h),s:Math.round(a.s),v:Math.round(a.v)}}}function F(r,o){let{rgb:t}=k(r);return `rgba(${t.r}, ${t.g}, ${t.b}, ${o})`}function er(r,o){let{hsl:t}=k(r),e={h:o,s:t.s,l:t.l},n=A(e.h,e.s,e.l);return lr({r:n.r,g:n.g,b:n.b})}function Zr(r,o,t=1){let e=k(r);if(o==="rgb")return t!==1?`rgba(${e.rgb.r}, ${e.rgb.g}, ${e.rgb.b}, ${t})`:`rgb(${e.rgb.r}, ${e.rgb.g}, ${e.rgb.b})`;if(o==="hsl")return t!==1?`hsla(${e.hsl.h}, ${e.hsl.s}%, ${e.hsl.l}%, ${t})`:`hsl(${e.hsl.h}, ${e.hsl.s}%, ${e.hsl.l}%)`;if(o==="hex")return e.hex;if(o==="hsv")return `hsv(${e.hsv.h}, ${e.hsv.s}%, ${e.hsv.v}%)`;if(o==="cmyk"){let n=L(e.rgb.r,e.rgb.g,e.rgb.b);return `cmyk(${Math.round(n.c*100)}%, ${Math.round(n.m*100)}%, ${Math.round(n.y*100)}%, ${Math.round(n.k*100)}%)`}return r}function rt(r){return new S(r.h,r.s,r.l).toString()}function lr(r){return new v(r.r,r.g,r.b).toString()}function tt(r){return new $(r.h,r.s,r.v).toString()}function et(r){return new H(r.c,r.m,r.y,r.k).toString()}function ot(r){return new E(r).toString()}var or=(r,o)=>{let t=o.getBoundingClientRect(),e=0,n=0;"touches"in r?r.touches.length>0?(e=r.touches[0].clientX,n=r.touches[0].clientY):r.changedTouches&&r.changedTouches.length>0&&(e=r.changedTouches[0].clientX,n=r.changedTouches[0].clientY):(e=r.clientX,n=r.clientY);let i=Math.min(Math.max(0,Math.round(e-t.left)),o.clientWidth),s=Math.min(Math.max(0,Math.round(n-t.top)),o.clientHeight);return {x:i,y:s}},M=(r,o,t,e)=>{if(!r)return ()=>{};let n=false,i=null,s=a=>{if(!n||a.pointerId!==i)return;a.preventDefault();let b=or(a,r);requestAnimationFrame(()=>{o(b);});},c=a=>{!n||a.pointerId!==i||(n=false,r.releasePointerCapture(a.pointerId),i=null,r.removeEventListener("pointermove",s),r.removeEventListener("pointerup",c),t&&t());},u=a=>{if(n)return;n=true,i=a.pointerId,r.setPointerCapture(a.pointerId),a.preventDefault(),a.stopPropagation(),r.addEventListener("pointermove",s),r.addEventListener("pointerup",c);let b=or(a,r);o(b);};return r.addEventListener("pointerdown",u),e?.current&&e.current.addEventListener("pointerdown",u),()=>{r.removeEventListener("pointerdown",u),e?.current&&e.current.removeEventListener("pointerdown",u),n&&i!==null&&(r.removeEventListener("pointermove",s),r.removeEventListener("pointerup",c),r.releasePointerCapture(i));}};function x(...r){let o=[];return r.forEach(t=>{if(!t)return;let e=typeof t;if(e==="string"||e==="number")o.push(t);else if(Array.isArray(t)){if(t.length){let n=x(...t);n&&o.push(n);}}else if(e==="object")if(t.toString===Object.prototype.toString)for(let n in t)Object.hasOwnProperty.call(t,n)&&t[n]&&o.push(n);else o.push(t.toString());}),o.join(" ")}var z=createContext(void 0),w=()=>{let r=useContext(z);if(r===void 0)throw new Error("usePageBuilder must be used within a PageBuilderProvider");return r};var G=({classNames:r={}})=>{let{hue:o,color:t,setColor:e}=w(),n=useRef(null),i=useRef(null),s=useRef(null),c=useRef(false),u=useRef(false);useEffect(()=>{n.current&&s.current&&(n.current.width=s.current.clientWidth??0,n.current.height=s.current.clientHeight??0,J(n.current,o),m(o));},[o]),useEffect(()=>s.current?M(s.current,b,d,i):void 0,[]),useEffect(()=>{a(t);},[]);let a=useCallback(h=>{if(!n.current||!i.current||u.current)return;u.current=true;let{rgb:g}=k(h),y=new v(g.r,g.g,g.b),C=tr(n.current,y.toString());C&&(i.current.style.transform=`translate(${C.x}px, ${C.y}px) translate(-50%, -50%)`),e(h);},[]),b=useCallback(({x:h,y:g})=>{if(!s.current||!i.current)return;let y=Math.max(0,Math.min(h,s.current.clientWidth-1)),C=Math.max(0,Math.min(g,s.current.clientHeight-1));if(i.current.style.transform=`translate(${y}px, ${C}px) translate(-50%, -50%)`,c.current=true,!n.current)return;let q=rr(n.current,y,C);q&&e(q);},[]),m=useCallback(h=>{let g=er(t,h);e(g);},[t]),d=useCallback(()=>{c.current=false;},[]),f=useCallback(h=>{h.stopPropagation();},[]);return jsxs("div",{className:x("cp-color-block",r.container),ref:s,children:[jsx("canvas",{ref:n,className:x("cp-color-block__canvas",r.gradient)}),jsx("div",{ref:i,className:x(r.marker,"cp-color-block__marker"),style:{backgroundColor:t},onMouseDown:f,onTouchStart:h=>h.stopPropagation()})]})};var V=({classNames:r})=>{let{hue:o,setHue:t,setColor:e,color:n}=w(),i=useRef(null),s=useRef(null),c=useRef(null),u=useRef(false),a=useRef(false);useEffect(()=>{i.current&&c.current&&(i.current.width=c.current.clientWidth??0,i.current.height=c.current.clientHeight??0,K(i.current));},[]),useEffect(()=>{if(!i.current||!s.current||a.current)return;a.current=true;let f=Z(i.current,o);typeof f=="number"&&(s.current.style.transform=`translateX(${f}px) translate(-50%, -50%)`);},[]);let b=useCallback(({x:f})=>{if(!c.current||!s.current)return;let h=f;if(s.current.style.transform=`translateX(${h}px) translate(-50%, -50%)`,u.current=true,!i.current)return;let g=Q(i.current,h);typeof g=="number"&&t(g);},[]),m=useCallback(()=>{u.current=false;},[]);useEffect(()=>!c.current||!s.current?void 0:M(c.current,b,m,s),[b,m]);let d=f=>{f.stopPropagation();};return jsxs("div",{className:x("cp-color-strip",r?.container),ref:c,children:[jsx("canvas",{ref:i,className:x("cp-color-strip__canvas",r?.canvas)}),jsx("div",{ref:s,className:x("cp-color-strip__marker",r?.marker),style:{backgroundColor:`hsla(${o}, 100%, 50%, 1)`},onMouseDown:d})]})};var j=({classNames:r})=>{let{color:o,opacity:t,setOpacity:e,setColor:n}=w(),i=useRef(null),s=useRef(null),c=useRef(false),u=useRef(false);useEffect(()=>{let d=F(o,t);n(d);},[t]),useEffect(()=>i.current?M(i.current,a,b,s):void 0,[]),useEffect(()=>{if(!i.current||!s.current||u.current)return;u.current=true;let f=i.current.offsetWidth*t;s.current.style.transform=`translateX(${f}px) translate(-50%, -50%)`;},[]);let a=useCallback(({x:d})=>{if(!i.current||!s.current)return;let f=i.current.offsetWidth,h=Math.max(0,Math.min(f,d));s.current.style.transform=`translateX(${h}px) translate(-50%, -50%)`,c.current=true;let g=h/f;e(g);},[]),b=useCallback(()=>{c.current=false;},[]),m=d=>{d.stopPropagation();};return jsx("div",{className:x("cp-opacity-slider",r?.container),style:{background:`linear-gradient(to right, rgba(0,0,0,0), ${F(o,1)})`},ref:i,children:jsx("div",{ref:s,className:x("cp-opacity-slider__marker",r?.marker),onMouseDown:m,onTouchStart:d=>d.stopPropagation(),style:{backgroundColor:o}})})};var P=({children:r,onChange:o,defaultColor:t="rgb(255,255,255)"})=>{let[e,n]=useState(255),[i,s]=useState(t),[c,u]=useState(1),[a,b]=useState(true);return useEffect(()=>{o(i,c,e);},[i,c,e]),useEffect(()=>{let{rgb:{r:m,g:d,b:f,a:h},hsl:{h:g}}=k(t);n(g),s(`rgb(${m}, ${d}, ${f})`),u(h??1),b(false);},[]),jsx(z.Provider,{value:{hue:e,opacity:c,color:i,setColor:s,setHue:n,setOpacity:u},children:!a&&r})};P.displayName="ColorPicker";P.Block=()=>jsx(G,{});P.Block.displayName="ColorPicker.Block";P.Strip=()=>jsx(V,{});P.Strip.displayName="ColorPicker.Strip";P.Opacity=()=>jsx(j,{});

export { G as ColorBlock, P as ColorPicker, z as ColorPickerContext, V as ColorStrip, j as OpacitySlider, er as changeHue, F as changeOpacity, et as cmykToString, Zr as convert, ot as hexToString, rt as hslToString, tt as hsvToString, k as parseColor, lr as rgbToString, w as useColorPicker };
